<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Comprehensive Error Handling in Unsplasharp | Unsplasharp Documentation </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Comprehensive Error Handling in Unsplasharp | Unsplasharp Documentation ">
      
      
      <link rel="icon" href="favicon.ico">
      <link rel="stylesheet" href="public/docfx.min.css">
      <link rel="stylesheet" href="public/main.css">
      <meta name="docfx:navrel" content="toc.html">
      <meta name="docfx:tocrel" content="toc.html">
      
      <meta name="docfx:rel" content="">
      
      
      <meta name="docfx:docurl" content="https://github.com/rootasjey/unsplasharp/blob/master/docs/error-handling.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="index.html">
            <img id="logo" class="svg" src="logo.svg" alt="Unsplasharp">
            Unsplasharp
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="comprehensive-error-handling-in-unsplasharp">Comprehensive Error Handling in Unsplasharp</h1>

<p>This document describes the comprehensive error handling system introduced in Unsplasharp, providing structured exceptions with rich context information for better debugging and error recovery.</p>
<h2 id="overview">Overview</h2>
<p>The new error handling system provides:</p>
<ul>
<li><strong>Specific Exception Types</strong>: Different exceptions for different error scenarios</li>
<li><strong>Rich Error Context</strong>: Detailed information about requests, responses, and timing</li>
<li><strong>Intelligent Retry Logic</strong>: Smart retry decisions based on error types</li>
<li><strong>Backward Compatibility</strong>: Existing methods continue to work as before</li>
<li><strong>Enhanced Debugging</strong>: Correlation IDs and structured logging</li>
</ul>
<h2 id="exception-hierarchy">Exception Hierarchy</h2>
<h3 id="base-exception-unsplasharpexception">Base Exception: <code>UnsplasharpException</code></h3>
<p>All Unsplasharp-specific exceptions inherit from <code>UnsplasharpException</code>, which provides:</p>
<pre><code class="lang-csharp">public abstract class UnsplasharpException : Exception
{
    public string? RequestUrl { get; }           // The URL that caused the error
    public string? HttpMethod { get; }           // HTTP method used
    public ErrorContext? Context { get; }        // Rich error context
}
</code></pre>
<h3 id="specific-exception-types">Specific Exception Types</h3>
<h4 id="unsplasharphttpexception"><code>UnsplasharpHttpException</code></h4>
<p>For HTTP-related errors with status codes:</p>
<pre><code class="lang-csharp">public class UnsplasharpHttpException : UnsplasharpException
{
    public HttpStatusCode? StatusCode { get; }   // HTTP status code
    public string? ResponseContent { get; }      // Response body
    public bool IsRetryable { get; }             // Whether error is retryable
}
</code></pre>
<h4 id="unsplasharpauthenticationexception"><code>UnsplasharpAuthenticationException</code></h4>
<p>For authentication failures (401 Unauthorized):</p>
<pre><code class="lang-csharp">var client = new UnsplasharpClient(&quot;invalid_app_id&quot;);
try {
    var photo = await client.GetRandomPhotoAsync();
} catch (UnsplasharpAuthenticationException ex) {
    Console.WriteLine($&quot;Authentication failed: {ex.Message}&quot;);
    // Check your application ID
}
</code></pre>
<h4 id="unsplasharpnotfoundexception"><code>UnsplasharpNotFoundException</code></h4>
<p>For resource not found errors (404 Not Found):</p>
<pre><code class="lang-csharp">try {
    var photo = await client.GetPhotoAsync(&quot;invalid_photo_id&quot;);
} catch (UnsplasharpNotFoundException ex) {
    Console.WriteLine($&quot;Photo '{ex.ResourceId}' not found&quot;);
    Console.WriteLine($&quot;Resource type: {ex.ResourceType}&quot;);
}
</code></pre>
<h4 id="unsplasharpratelimitexception"><code>UnsplasharpRateLimitException</code></h4>
<p>For rate limit exceeded errors (429 Too Many Requests):</p>
<pre><code class="lang-csharp">try {
    var photos = await client.SearchPhotosAsync(&quot;nature&quot;);
} catch (UnsplasharpRateLimitException ex) {
    Console.WriteLine($&quot;Rate limit exceeded: {ex.RateLimitRemaining}/{ex.RateLimit}&quot;);
    Console.WriteLine($&quot;Reset time: {ex.RateLimitReset}&quot;);
    
    // Wait until reset time or implement exponential backoff
    if (ex.RateLimitReset.HasValue) {
        var waitTime = ex.RateLimitReset.Value - DateTimeOffset.UtcNow;
        await Task.Delay(waitTime);
    }
}
</code></pre>
<h4 id="unsplasharpnetworkexception"><code>UnsplasharpNetworkException</code></h4>
<p>For network-related errors:</p>
<pre><code class="lang-csharp">try {
    var photo = await client.GetRandomPhotoAsync();
} catch (UnsplasharpNetworkException ex) {
    if (ex.IsRetryable) {
        Console.WriteLine(&quot;Network error occurred, retrying...&quot;);
        // Implement retry logic
    } else {
        Console.WriteLine(&quot;Permanent network error&quot;);
    }
}
</code></pre>
<h4 id="unsplasharptimeoutexception"><code>UnsplasharpTimeoutException</code></h4>
<p>For request timeout errors:</p>
<pre><code class="lang-csharp">try {
    var photo = await client.GetRandomPhotoAsync();
} catch (UnsplasharpTimeoutException ex) {
    Console.WriteLine($&quot;Request timed out after {ex.Timeout}&quot;);
    // Consider increasing timeout or checking network conditions
}
</code></pre>
<h4 id="unsplasharpparsingexception"><code>UnsplasharpParsingException</code></h4>
<p>For JSON parsing errors:</p>
<pre><code class="lang-csharp">try {
    var photo = await client.GetRandomPhotoAsync();
} catch (UnsplasharpParsingException ex) {
    Console.WriteLine($&quot;Failed to parse response: {ex.Message}&quot;);
    Console.WriteLine($&quot;Expected type: {ex.ExpectedType}&quot;);
    // Log raw content for debugging: ex.RawContent
}
</code></pre>
<h2 id="error-context">Error Context</h2>
<p>Every exception includes an <code>ErrorContext</code> object with detailed information:</p>
<pre><code class="lang-csharp">public class ErrorContext
{
    public DateTimeOffset Timestamp { get; }           // When error occurred
    public string? ApplicationId { get; }              // Your app ID
    public string? CorrelationId { get; }              // Unique request ID
    public Dictionary&lt;string, string&gt; RequestHeaders { get; }
    public Dictionary&lt;string, string&gt; ResponseHeaders { get; }
    public RateLimitInfo? RateLimitInfo { get; }       // Rate limit details
    public Dictionary&lt;string, object&gt; Properties { get; } // Custom properties
}
</code></pre>
<h3 id="using-error-context">Using Error Context</h3>
<pre><code class="lang-csharp">try {
    var photo = await client.GetRandomPhotoAsync();
} catch (UnsplasharpException ex) {
    var context = ex.Context;
    Console.WriteLine($&quot;Error occurred at: {context?.Timestamp}&quot;);
    Console.WriteLine($&quot;Correlation ID: {context?.CorrelationId}&quot;);
    Console.WriteLine($&quot;Summary: {context?.ToSummary()}&quot;);
    
    // Access rate limit information
    if (context?.RateLimitInfo != null) {
        var rateLimit = context.RateLimitInfo;
        Console.WriteLine($&quot;Rate limit: {rateLimit.Remaining}/{rateLimit.Limit}&quot;);
    }
}
</code></pre>
<h2 id="backward-compatibility">Backward Compatibility</h2>
<p>Existing methods continue to work exactly as before, returning <code>null</code> or empty collections on errors:</p>
<pre><code class="lang-csharp">// Old approach - still works
var photo = await client.GetRandomPhoto(); // Returns null on error
if (photo == null) {
    Console.WriteLine(&quot;Failed to get photo&quot;);
}

// New approach - throws exceptions
try {
    var photo = await client.GetRandomPhotoAsync(); // Throws on error
    Console.WriteLine($&quot;Got photo: {photo.Id}&quot;);
} catch (UnsplasharpException ex) {
    Console.WriteLine($&quot;Error: {ex.Message}&quot;);
}
</code></pre>
<h2 id="migration-guide">Migration Guide</h2>
<h3 id="for-new-code">For New Code</h3>
<p>Use the new <code>*Async</code> methods that throw exceptions:</p>
<pre><code class="lang-csharp">// Instead of:
var photo = await client.GetRandomPhoto();
if (photo == null) { /* handle error */ }

// Use:
try {
    var photo = await client.GetRandomPhotoAsync();
    // Use photo
} catch (UnsplasharpException ex) {
    // Handle specific error types
}
</code></pre>
<h3 id="for-existing-code">For Existing Code</h3>
<p>No changes required - existing methods maintain their behavior:</p>
<pre><code class="lang-csharp">// This continues to work unchanged
var photos = await client.SearchPhotos(&quot;nature&quot;);
if (photos.Count == 0) {
    // Handle no results or error
}
</code></pre>
<h3 id="gradual-migration">Gradual Migration</h3>
<p>You can migrate gradually by replacing method calls one at a time:</p>
<pre><code class="lang-csharp">// Step 1: Replace method call
// var photo = await client.GetRandomPhoto();
var photo = await client.GetRandomPhotoAsync();

// Step 2: Add exception handling
try {
    var photo = await client.GetRandomPhotoAsync();
    // Use photo
} catch (UnsplasharpNotFoundException) {
    // Handle not found
} catch (UnsplasharpRateLimitException ex) {
    // Handle rate limiting
    await Task.Delay(ex.TimeUntilReset ?? TimeSpan.FromMinutes(1));
} catch (UnsplasharpException ex) {
    // Handle other errors
    logger.LogError(ex, &quot;Unsplash API error: {Context}&quot;, ex.Context?.ToSummary());
}
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-handle-specific-exception-types">1. Handle Specific Exception Types</h3>
<pre><code class="lang-csharp">try {
    var photo = await client.GetPhotoAsync(photoId);
} catch (UnsplasharpNotFoundException) {
    // Photo doesn't exist - show user-friendly message
} catch (UnsplasharpRateLimitException ex) {
    // Rate limited - implement backoff
    await Task.Delay(ex.TimeUntilReset ?? TimeSpan.FromMinutes(1));
} catch (UnsplasharpNetworkException ex) when (ex.IsRetryable) {
    // Transient network error - retry
} catch (UnsplasharpException ex) {
    // Other API errors - log and show generic error
    logger.LogError(ex, &quot;API error: {Context}&quot;, ex.Context?.ToSummary());
}
</code></pre>
<h3 id="2-use-correlation-ids-for-debugging">2. Use Correlation IDs for Debugging</h3>
<pre><code class="lang-csharp">try {
    var photo = await client.GetRandomPhotoAsync();
} catch (UnsplasharpException ex) {
    logger.LogError(ex, &quot;Request failed [CorrelationId: {CorrelationId}]: {Message}&quot;, 
        ex.Context?.CorrelationId, ex.Message);
}
</code></pre>
<h3 id="3-implement-intelligent-retry-logic">3. Implement Intelligent Retry Logic</h3>
<pre><code class="lang-csharp">public async Task&lt;Photo&gt; GetPhotoWithRetry(string photoId, int maxRetries = 3) {
    for (int attempt = 1; attempt &lt;= maxRetries; attempt++) {
        try {
            return await client.GetPhotoAsync(photoId);
        } catch (UnsplasharpNetworkException ex) when (ex.IsRetryable &amp;&amp; attempt &lt; maxRetries) {
            var delay = TimeSpan.FromSeconds(Math.Pow(2, attempt)); // Exponential backoff
            await Task.Delay(delay);
        } catch (UnsplasharpRateLimitException ex) when (attempt &lt; maxRetries) {
            var delay = ex.TimeUntilReset ?? TimeSpan.FromMinutes(1);
            await Task.Delay(delay);
        }
    }
    throw new InvalidOperationException($&quot;Failed to get photo after {maxRetries} attempts&quot;);
}
</code></pre>
<h3 id="4-monitor-rate-limits">4. Monitor Rate Limits</h3>
<pre><code class="lang-csharp">try {
    var photos = await client.SearchPhotosAsync(&quot;nature&quot;);
} catch (UnsplasharpException ex) {
    if (ex.Context?.RateLimitInfo != null) {
        var rateLimit = ex.Context.RateLimitInfo;
        if (rateLimit.Remaining &lt; 100) {
            logger.LogWarning(&quot;Rate limit running low: {Remaining}/{Limit}&quot;, 
                rateLimit.Remaining, rateLimit.Limit);
        }
    }
}
</code></pre>
<h2 id="configuration">Configuration</h2>
<p>The error handling system can be configured through the retry policies:</p>
<pre><code class="lang-csharp">// The client automatically uses intelligent retry policies
var client = new UnsplasharpClient(&quot;your_app_id&quot;, logger: logger);

// Retry policies handle:
// - Exponential backoff with jitter
// - Rate limit-aware delays
// - Circuit breaker patterns (optional)
// - Comprehensive logging
</code></pre>
<h2 id="logging-integration">Logging Integration</h2>
<p>The error handling system integrates with Microsoft.Extensions.Logging:</p>
<pre><code class="lang-csharp">using var loggerFactory = LoggerFactory.Create(builder =&gt;
    builder.AddConsole().SetMinimumLevel(LogLevel.Debug));

var logger = loggerFactory.CreateLogger&lt;UnsplasharpClient&gt;();
var client = new UnsplasharpClient(&quot;your_app_id&quot;, logger: logger);

// All errors are automatically logged with correlation IDs and context
</code></pre>
<h2 id="summary">Summary</h2>
<p>The comprehensive error handling system provides:</p>
<ul>
<li>✅ <strong>Better Debugging</strong>: Specific exception types with rich context</li>
<li>✅ <strong>Intelligent Retries</strong>: Smart retry logic based on error types</li>
<li>✅ <strong>Rate Limit Awareness</strong>: Automatic rate limit detection and handling</li>
<li>✅ <strong>Backward Compatibility</strong>: Existing code continues to work</li>
<li>✅ <strong>Enhanced Monitoring</strong>: Correlation IDs and structured logging</li>
<li>✅ <strong>Production Ready</strong>: Circuit breakers and resilience patterns</li>
</ul>
<p>This system makes your applications more robust and easier to debug while maintaining full backward compatibility with existing code.</p>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/rootasjey/unsplasharp/blob/master/docs/error-handling.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>
